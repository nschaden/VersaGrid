/*
	VersaGrid
	author: 	nschaden
	web: 		nickschaden.com
	version: 	0.4
 */
(function(a){a.fn.versaGrid=function(c){var b={afterinit:function(){},basewidth:null,displaymethod:"show",forcespan:false,idealaspect:null,innerelements:"*",positioninner:"center",preventhorizontalgaps:true,preventverticalgaps:true,smallestbasewidth:false,zoom:1};a.fn.versaGrid.basewidth=100;a.fn.versaGrid.idealaspect=1;a.fn.versaGrid.itemdimensions=[];a.fn.versaGrid.options=a.extend({},b,c);a.fn.versaGrid.previtemsrow=0;a.fn.versaGrid.dimensonscalculated=false;this.calcWidthRatio=function(){var e=this;var u=e.children();if(!u.length){return}var C=[];var j={};var p={};var s=0;var n=0;for(var A=0;A<u.length;A++){var g=u.eq(A);g.addClass("versaGridItem");var q=g.outerWidth();var B=g.outerHeight();if(q<1){setTimeout(function(){e.versaGrid()},200);return}var D=Math.round((q/B)*10)/10;C.push({width:q,height:B,aspect:D});var f=j[D];j[D]=(typeof f=="undefined")?1:f+1;s+=D;var x=p[q];p[q]=(typeof x=="undefined")?1:x+1;n+=q}a.fn.versaGrid.dimensonscalculated=true;var r=s/u.length;var k=n/u.length;var z=u[0].aspect;var v=u[0].width;if(a.fn.versaGrid.options.idealaspect){z=a.fn.versaGrid.options.idealaspect}if(a.fn.versaGrid.options.basewidth){v=a.fn.versaGrid.options.basewidth}for(A=0;A<2;A++){var y,o,m;if(!A&&a.fn.versaGrid.options.idealaspect){continue}if(A&&a.fn.versaGrid.options.basewidth){continue}if(!A){y=j;o=r}else{y=p;o=k}var E=999999;m=1;for(value in y){if(A&&((a.fn.versaGrid.options.smallestbasewidth&&a.fn.versaGrid.options.forcespan)||(a.fn.versaGrid.options.preventhorizontalgaps&&!a.fn.versaGrid.options.forcespan))){if(value<E){E=value;m=value}}else{if(y[value]/u.length>=0.8){m=value;break}if(Math.abs(o-value)<E){E=Math.abs(o-value);m=value}}}if(!A){z=m}else{v=m*a.fn.versaGrid.options.zoom}}if(!a.fn.versaGrid.options.forcespan&&a.fn.versaGrid.options.preventverticalgaps){var l=Math.round(v/z);var t=true;while(t){t=false;for(A=0;A<u.length;A++){if(C[A].height<l){t=true;z=Math.round((parseFloat(z)+0.05)*100)/100;l=Math.round(v/z);break}}}}a.fn.versaGrid.idealaspect=z;a.fn.versaGrid.basewidth=v;a.fn.versaGrid.itemdimensions=C};this.clearExistingGrid=function(){var f=this.children();if(!f.hasClass("versaGridItem")){return}var e=f.find(".versaGridInner");f.css({width:"auto",height:"auto"});e.css({left:"0",top:"0"}).removeClass("wide").removeClass("tall").removeClass("versaGridInner");a(window).unbind("resize.versaGrid")};this.display=function(){var e=this.children();if(a.fn.versaGrid.options.displaymethod=="fadeSlow"||a.fn.versaGrid.options.displaymethod=="fadeFast"){var f=(a.fn.versaGrid.options.displaymethod=="fadeSlow")?800:200;if(e.css("visibility")=="hidden"){e.css({opacity:0,visibility:"visible"});e.first().fadeTo(f,1,a.fn.versaGrid.options.afterinit);e.not(":first").fadeTo(f,1)}else{e.first().fadeIn(f,a.fn.versagrid.options.afterinit);e.not(":first").fadeIn(f)}}else{if(a.fn.versaGrid.options.displaymethod=="show"){if(e.css("visibility")=="hidden"){e.css("visibility","visible")}else{e.show()}a.fn.versaGrid.options.afterinit()}else{a.fn.versaGrid.options.afterinit()}}};this.positionInner=function(){var h=this.children();var e=a.fn.versaGrid.idealaspect;var m=a.fn.versaGrid.itemdimensions;var n=this.width();for(var f=0;f<h.length;f++){var l=h.eq(f);var k=l.find(a.fn.versaGrid.options.innerelements);k.addClass("versaGridInner");if(a.fn.versaGrid.options.positioninner=="topLeft"||a.fn.versaGrid.options.positioninner=="topRight"||a.fn.versaGrid.options.positioninner=="bottomLeft"||a.fn.versaGrid.options.positioninner=="bottomRight"){k.addClass(a.fn.versaGrid.options.positioninner)}var g=((m[f].width/m[f].height)>e);var j;if(a.fn.versaGrid.options.forcespan){l.addClass(g?"wide":"tall")}if(a.fn.versaGrid.options.forcespan&&a.fn.versaGrid.options.positioninner=="center"){j=g?(m[f].width/m[f].height)/e:e/(m[f].width/m[f].height);j=Math.round((j-1)*100)/2;if(g){k.css("left",j*-1+"%")}else{k.css("top",j*-1+"%")}}}};this.resizeGrid=function(){var l=this.children();var h=a.fn.versaGrid.idealaspect;var k=a.fn.versaGrid.basewidth;var j=a.fn.versaGrid.previtemsrow;var e=Math.ceil(this.width()/k);var f=Math.ceil(l.length/e);a.fn.versaGrid.previtemsrow=e;this.height(f*(this.width()/e/h));if(e!=j){l.css({width:1/e*100+"%",height:1/f*100+"%"})}if(!a.fn.versaGrid.options.forcespan&&a.fn.versaGrid.options.positioninner=="center"){var o=l.find(a.fn.versaGrid.options.innerelements);var p=this.width();var n=a.fn.versaGrid.itemdimensions;for(var g=0;g<o.length;g++){var m=o.eq(g);percentageleft=n[g].width/(p/e);percentageleft=Math.round((percentageleft-1)*100)/2;percentagetop=n[g].height/((p/e)/h);percentagetop=Math.round((percentagetop-1)*100)/2;m.css("left",percentageleft*-1+"%");m.css("top",percentagetop*-1+"%")}}};var d=this;d.addClass("versaGridContainer");d.clearExistingGrid();d.calcWidthRatio();if(a.fn.versaGrid.dimensonscalculated){a(window).bind("resize.versaGrid",function(){d.resizeGrid()});d.resizeGrid();d.positionInner();d.display()}}})(jQuery);